<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    <!-- Inherit Form View to Modify it -->
    <record id="mail_activity_view_form_popup_inherit" model="ir.ui.view">
        <field name="name">mail_activity_view_form_popup_inherit</field>
        <field name="model">mail.activity</field>
        <field name="priority" eval="20"/>
        <field name="inherit_id" ref="mail.mail_activity_view_form_popup"/>
        <field name="arch" type="xml">

            <xpath expr="//group[3]/group[2]/field[@name='user_id']" position="after">
                <field name="partner_id" attrs="{'invisible': ['|',('opportunity_id', '!=', False),('lead_id', '!=', False)]}"/>
                <field name="opportunity_id" attrs="{'invisible': ['|',('partner_id', '!=', False),('lead_id', '!=', False)]}" domain="[('type', '=','opportunity' ), ]"/>
                <field name="lead_id" attrs="{'invisible': ['|',('opportunity_id', '!=', False),('partner_id', '!=', False)]}" domain="[('type', '=','lead' ), ]"/>
             <label for="date_from" string="Date"/>
                                <div name="date" class="d-flex">
                                    <field name="date_from" eval="DateTime.today().strftime('%Y-%m-%d 07:00:00')"/>
<!--                                    <span class="oe_inline o_form_label mx-3 oe_read_only"> To </span>-->
                                    <!-- Bigger margin on the left because in edit mode the external link button covers the text -->
                                    <span class="oe_inline o_form_label mr-3 ml-5 oe_edit_only"> To </span>
                                    <field name="date_to"/>
                                </div>
            </xpath>
            <xpath expr="//sheet" position="before">
<header>
    <field name="activity_type" widget="statusbar"/>
</header>            </xpath>
        </field>
    </record>
         <record id="mail_activity_view_calendar_crm" model="ir.ui.view">
        <field name="name">mail_activity_view_calendar_inherit</field>
        <field name="model">mail.activity</field>
        <field name="arch" type="xml">
<calendar string="Activity" date_start="date_deadline" color="activity_type" mode="month">
                <field name="user_id" avatar_field="avatar_128"/>
                <field name="res_name"/>
                <field name="date_deadline"/>
                <field name="summary"/>
                <field name="activity_type" filters="1"/>
                <field name="activity_type_id" invisible="1"/>
            </calendar>

        </field>
         </record>
      <record id="mail_activity_action" model="ir.actions.act_window">
          <field name="name">Activities</field>
          <field name="type">ir.actions.act_window</field>
          <field name="res_model">mail.activity</field>
          <field name="view_mode">calendar,form</field>
          <field name="view_id" ref="mail_activity_view_calendar_crm"/>
           <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'calendar', 'view_id': ref('mail_activity_view_calendar_crm')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('mail_activity_view_form_popup_inherit')}),
                ]"/>

      </record>

<menuitem id="crm_lead_activities_menu" name="Activities" parent="crm.crm_menu_root" action="mail_activity_action" sequence="2"/>
    </data>
</odoo>