<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    <!-- Inherit Form View to Modify it -->
    <record id="mail_activity_view_form_popup_inherit" model="ir.ui.view">
        <field name="name">mail_activity_view_form_popup_inherit</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_form_popup"/>
        <field name="arch" type="xml">

            <xpath expr="//group[3]/group[2]/field[@name='user_id']" position="after">
                <field name="partner_id" attrs="{'invisible': [('opportunity_id', '!=', False)]}"/>
                <field name="opportunity_id" attrs="{'invisible': [('partner_id', '!=', False)]}"/>
            </xpath>

        </field>
    </record>
         <record id="mail_activity_view_calendar_crm" model="ir.ui.view">
        <field name="name">mail_activity_view_calendar_inherit</field>
        <field name="model">mail.activity</field>
        <field name="arch" type="xml">
<calendar string="Activity" date_start="date_deadline" color="activity_type_id" mode="month">
                <field name="user_id" avatar_field="avatar_128"/>
                <field name="res_name"/>
                <field name="date_deadline"/>
                <field name="summary"/>
                <field name="activity_type_id" filters="1" invisible="1"/>
            </calendar>

        </field>
         </record>
      <record id="mail_activity_action" model="ir.actions.act_window">
          <field name="name">Activities</field>
          <field name="type">ir.actions.act_window</field>
          <field name="res_model">mail.activity</field>
          <field name="view_mode">calendar,form</field>
          <field name="view_id" ref="mail_activity_view_calendar_crm"/>
           <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'calendar', 'view_id': ref('mail_activity_view_calendar_crm')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('mail.mail_activity_view_form_popup')}),
                ]"/>

      </record>

<!-- This Menu Item must have a parent and an action -->
<menuitem id="crm_lead_activities_menu" name="Activities" parent="crm.crm_menu_root" action="mail_activity_action" sequence="2"/>
    </data>
</odoo>